<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master Meds Pro</title>
    <!-- React & ReactDOM CDN -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel CDN for in-browser transpilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide React CDN - Requires window.react = window.React -->
    <script>window.react = window.React;</script>
    <script src="https://unpkg.com/lucide-react@0.344.0/dist/umd/lucide-react.min.js"></script>
    <style>
        body { margin: 0; padding: 0; background: #f8fafc; }
        #root { min-height: 100vh; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;
        const {
          Activity, Droplets, Syringe, Plus, X, Sparkles,
          FileText, Pill, AlertCircle, ShoppingCart,
          Moon, Sun, RotateCcw, Camera, Volume2,
          Loader2, UserPlus, Settings, ShieldCheck,
          Smile, Megaphone, ChevronDown, Check,
          CalendarDays, HeartPulse, Stethoscope, Thermometer,
          MessageCircle, Send, Download, BarChart3, Trophy, Lock, Key,
          Leaf, Apple, Utensils, Zap, BedDouble, Clock, Mic, FolderOpen,
          Mail, Phone, AlertTriangle, ToggleLeft, ToggleRight,
          TrendingUp, TrendingDown, ClipboardCheck, Salad, Save
        } = LucideReact;

        const safeJsonParse = (text) => {
          try {
            const cleaned = text.replace(/```json\n?|```/g, '').trim();
            return JSON.parse(cleaned);
          } catch (e) {
            console.error("Failed to parse AI response:", text, e);
            throw e;
          }
        };

        const VIVID_THEME = {
          mint: 'bg-teal-50 border-teal-100 text-teal-600',
          teal: 'bg-[#26A69A] text-white',
          yellow: 'bg-amber-50 border-amber-100 text-amber-600',
          purple: 'bg-indigo-50 border-indigo-100 text-indigo-600',
          red: 'bg-rose-50 border-rose-100 text-rose-600',
          orange: 'bg-orange-50 border-orange-100 text-orange-600',
          black: 'bg-gray-900 text-white',
          white: 'bg-white border-2 border-gray-100'
        };

        function DashboardCard({ colorClass, title, icon: Icon, children, className="" }) {
          return (
            <div className={`p-6 rounded-[2.5rem] ${colorClass} ${className} shadow-sm border-2`}>
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-black uppercase text-xs tracking-widest opacity-80">{title}</h3>
                {Icon && <Icon size={20} className="opacity-60"/>}
              </div>
              {children}
            </div>
          );
        }

        function App() {
          const [activeTab, setActiveTab] = useState('home');
          const [meds, setMeds] = useState([
            { id: 1, name: 'Humira', dose: '40mg', time: '08:00 AM', status: 'taken', color: 'teal', type: 'injection' },
            { id: 2, name: 'Methotrexate', dose: '15mg', time: '10:00 AM', status: 'pending', color: 'indigo', type: 'pill' }
          ]);
          const [apiKeys, setApiKeys] = useState({ gemini: '' });
          const [isAnalyzing, setIsAnalyzing] = useState(false);
          const [report, setReport] = useState(null);
          const [flareForecast, setFlareForecast] = useState(null);
          const [dietPlan, setDietPlan] = useState(null);
          const [showDietModule, setShowDietModule] = useState(true);
          const [chatInput, setChatInput] = useState('');
          const [chatHistory, setChatHistory] = useState([]);
          const [isListening, setIsListening] = useState(false);
          const [vault, setVault] = useState([]);
          const [pharmacy, setPharmacy] = useState({ name: '', phone: '', email: '' });
          const [emergencyContact, setEmergencyContact] = useState('');

          const fileInputRef = useRef(null);
          const chatEndRef = useRef(null);

          useEffect(() => {
            const saved = localStorage.getItem('master_meds_data');
            if(saved) {
              const data = JSON.parse(saved);
              if(data.meds) setMeds(data.meds);
              if(data.apiKeys) setApiKeys(data.apiKeys);
              if(data.vault) setVault(data.vault);
              if(data.pharmacy) setPharmacy(data.pharmacy);
              if(data.emergencyContact) setEmergencyContact(data.emergencyContact);
            }
          }, []);

          useEffect(() => {
            localStorage.setItem('master_meds_data', JSON.stringify({ meds, apiKeys, vault, pharmacy, emergencyContact }));
          }, [meds, apiKeys, vault, pharmacy, emergencyContact]);

          const fetchWithRetry = async (url, options, retries = 3) => {
            for (let i = 0; i < retries; i++) {
              try {
                const response = await fetch(url, options);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                return await response.json();
              } catch (e) {
                if (i === retries - 1) throw e;
                await new Promise(r => setTimeout(r, 1000 * (i + 1)));
              }
            }
          };

          const runClinicalAnalysis = async () => {
            if(!apiKeys.gemini) return alert("Please enter Gemini API Key in Admin tab");
            setIsAnalyzing(true);
            try {
              const data = await fetchWithRetry(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKeys.gemini}`, {
                method: 'POST',
                body: JSON.stringify({
                  contents: [{ parts: [{ text: `Analyze these meds and symptoms: ${JSON.stringify(meds)}. Return JSON only: { "summary": "...", "score": 0-100, "warnings": [] }` }] }]
                })
              });
              const analysis = safeJsonParse(data.candidates[0].content.parts[0].text);
              setReport(analysis);
            } catch (e) {
              alert("Analysis failed: " + e.message);
            } finally {
              setIsAnalyzing(false);
            }
          };

          const generateFlareForecast = async () => {
            if(!apiKeys.gemini) return;
            try {
              const data = await fetchWithRetry(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKeys.gemini}`, {
                method: 'POST',
                body: JSON.stringify({
                  contents: [{ parts: [{ text: `Based on medication compliance, forecast flare-up risk. Return JSON only: { "risk": "Low/Med/High", "percentage": 0-100, "factor": "Reason" }` }] }]
                })
              });
              const result = safeJsonParse(data.candidates[0].content.parts[0].text);
              setFlareForecast(result);
            } catch (e) { console.error(e); }
          };

          const generateDietPlan = async () => {
            if(!apiKeys.gemini) return;
            try {
              const data = await fetchWithRetry(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKeys.gemini}`, {
                method: 'POST',
                body: JSON.stringify({
                  contents: [{ parts: [{ text: `Create an anti-inflammatory diet plan for today. Return JSON only: { "breakfast": "...", "lunch": "...", "dinner": "...", "snack": "..." }` }] }]
                })
              });
              const plan = safeJsonParse(data.candidates[0].content.parts[0].text);
              setDietPlan(plan);
            } catch (e) { console.error(e); }
          };

          const playVoiceBriefing = async () => {
            if(!apiKeys.gemini) return;
            try {
              const res = await fetchWithRetry(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKeys.gemini}`, {
                method: 'POST',
                body: JSON.stringify({
                  contents: [{ parts: [{ text: "Create a 30-second audio briefing summary of the patient status. Be encouraging." }] }]
                })
              });
              const text = res.candidates[0].content.parts[0].text;
              const utterance = new SpeechSynthesisUtterance(text);
              window.speechSynthesis.speak(utterance);
            } catch (e) { console.error(e); }
          };

          const handlePillScan = async (e) => {
            const file = e.target.files[0];
            if(!file || !apiKeys.gemini) return;

            const reader = new FileReader();
            reader.onloadend = async () => {
               const base64 = reader.result.split(',')[1];
               try {
                  const res = await fetchWithRetry(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKeys.gemini}`, {
                     method: 'POST',
                     body: JSON.stringify({
                        contents: [{ parts: [
                           { inline_data: { mime_type: "image/jpeg", data: base64 } },
                           { text: "Identify this medication bottle. Return JSON only: { \"name\": \"...\", \"dose\": \"...\", \"instructions\": \"...\" }" }
                        ] }]
                     })
                  });
                  const result = safeJsonParse(res.candidates[0].content.parts[0].text);
                  setVault(prev => [{ id: Date.now(), ...result, image: reader.result, date: new Date().toLocaleDateString() }, ...prev]);
               } catch (e) { alert("Scan failed"); }
            };
            reader.readAsDataURL(file);
          };

          const handleVoiceInput = (setter) => {
             const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
             recognition.onstart = () => setIsListening(true);
             recognition.onend = () => setIsListening(false);
             recognition.onresult = (event) => {
                setter(event.results[0][0].transcript);
             };
             recognition.start();
          };

          const handleExportData = () => {
             const blob = new Blob([JSON.stringify({ meds, vault, pharmacy, emergencyContact }, null, 2)], { type: 'application/json' });
             const url = URL.createObjectURL(blob);
             const a = document.createElement('a');
             a.href = url;
             a.download = `master-meds-backup-${new Date().toISOString().split('T')[0]}.json`;
             a.click();
          };

          const handleOrderRefill = () => {
             if(!pharmacy.phone) return alert("Please set Pharmacy Phone in Admin tab first.");
             const cleanPhone = pharmacy.phone.replace(/[^0-9]/g, '');
             const text = `Hello ${pharmacy.name}, I would like to request a refill for my medications.`;
             window.open(`https://wa.me/${cleanPhone}?text=${encodeURIComponent(text)}`, '_blank');
          };

          return (
            <div className="max-w-md mx-auto bg-white min-h-screen pb-32 font-sans text-gray-900 overflow-x-hidden">
              {/* HEADER */}
              <header className="p-8 pt-12 flex justify-between items-center bg-white/80 backdrop-blur-md sticky top-0 z-[1000]">
                <div>
                   <h1 className="text-2xl font-black tracking-tighter text-teal-600 flex items-center gap-1">MASTER MEDS <span className="bg-teal-600 text-white px-2 py-0.5 rounded-lg text-[10px] uppercase tracking-widest">PRO</span></h1>
                   <p className="text-[10px] font-bold text-gray-400 uppercase tracking-widest mt-1">Clinical Grade Rewired • v7.4</p>
                </div>
                <div className="flex gap-2">
                   <button onClick={playVoiceBriefing} className="p-3 bg-teal-50 text-teal-600 rounded-2xl active:scale-90 transition-all shadow-sm border border-teal-100"><Volume2 size={20}/></button>
                   <div className="w-12 h-12 bg-gradient-to-br from-teal-400 to-teal-600 rounded-2xl shadow-lg border-2 border-white flex items-center justify-center text-white font-black">JS</div>
                </div>
              </header>

              <main className="px-6 space-y-8">
                 {/* --- HOME TAB --- */}
                 {activeTab === 'home' && (
                    <>
                       {/* STATUS BANNER */}
                       <div className="relative overflow-hidden p-8 rounded-[3rem] bg-gray-900 text-white shadow-2xl border-4 border-gray-100">
                          <div className="relative z-10">
                             <div className="flex items-center gap-2 mb-2">
                                <ShieldCheck size={16} className="text-teal-400"/>
                                <span className="text-[10px] font-black uppercase tracking-widest opacity-60">System Status: Active</span>
                             </div>
                             <h2 className="text-4xl font-black mb-4 tracking-tighter leading-none">ALL CLEAR FOR<br/><span className="text-teal-400">TODAY.</span></h2>
                             <div className="flex items-center gap-4">
                                <div className="flex -space-x-3">
                                   {[1,2,3].map(i => <div key={i} className="w-8 h-8 rounded-full border-2 border-gray-900 bg-teal-600 flex items-center justify-center text-[10px] font-black">{i}</div>)}
                                </div>
                                <span className="text-xs font-bold opacity-60">3 Meds Synced</span>
                             </div>
                          </div>
                          <Sparkles className="absolute -right-8 -bottom-8 text-teal-500/20" size={200}/>
                       </div>

                       {/* MEDICATION LOG */}
                       <DashboardCard colorClass={VIVID_THEME.white} title="Daily Schedule" icon={CalendarDays}>
                          <div className="space-y-4">
                             {meds.map(med => (
                                <div key={med.id} className="flex items-center justify-between p-5 bg-gray-50 rounded-[2rem] border-2 border-transparent hover:border-teal-100 transition-all group">
                                   <div className="flex items-center gap-4">
                                      <div className={`w-14 h-14 rounded-2xl flex items-center justify-center shadow-inner ${med.type === 'injection' ? 'bg-rose-100 text-rose-600' : 'bg-teal-100 text-teal-600'}`}>
                                         {med.type === 'injection' ? <Syringe size={24}/> : <Pill size={24}/>}
                                      </div>
                                      <div>
                                         <h4 className="font-black text-sm">{med.name}</h4>
                                         <p className="text-[11px] font-bold text-gray-400 uppercase">{med.dose} • {med.time}</p>
                                      </div>
                                   </div>
                                   <button
                                      onClick={() => setMeds(meds.map(m => m.id === med.id ? {...m, status: m.status === 'taken' ? 'pending' : 'taken'} : m))}
                                      className={`p-4 rounded-2xl transition-all ${med.status === 'taken' ? 'bg-teal-600 text-white shadow-lg shadow-teal-200' : 'bg-white border-2 border-gray-100 text-gray-300'}`}
                                   >
                                      {med.status === 'taken' ? <Check size={20} strokeWidth={3}/> : <Plus size={20} strokeWidth={3}/>}
                                   </button>
                                </div>
                             ))}
                          </div>
                       </DashboardCard>

                       {/* AI ANALYSIS SECTION */}
                       <div className="grid grid-cols-2 gap-4">
                          <div onClick={runClinicalAnalysis} className="p-6 rounded-[2.5rem] bg-indigo-600 text-white shadow-xl shadow-indigo-100 flex flex-col items-center justify-center text-center cursor-pointer active:scale-95 transition-all relative overflow-hidden">
                             {isAnalyzing ? <Loader2 className="animate-spin mb-2" size={32}/> : <Sparkles className="mb-2" size={32}/>}
                             <span className="text-[10px] font-black uppercase tracking-widest">Run Clinical</span>
                             <h4 className="font-black text-sm mt-1">ANALYSIS</h4>
                          </div>

                          <div onClick={handleOrderRefill} className="p-6 rounded-[2.5rem] bg-teal-50 border-2 border-teal-100 text-teal-600 flex flex-col items-center justify-center text-center cursor-pointer active:scale-95 transition-all">
                             <ShoppingCart className="mb-2" size={32}/>
                             <span className="text-[10px] font-black uppercase tracking-widest">Order Meds</span>
                             <h4 className="font-black text-sm mt-1">REFILL</h4>
                          </div>
                       </div>

                       {report && (
                          <DashboardCard colorClass={VIVID_THEME.black} title="Clinical Report" icon={ShieldCheck}>
                             <div className="flex items-end gap-2 mb-4">
                                <span className="text-5xl font-black text-teal-400 leading-none">{report.score}</span>
                                <span className="text-xs font-bold opacity-60 pb-1">HEALTH SCORE</span>
                             </div>
                             <p className="text-sm font-bold leading-relaxed mb-4">{report.summary}</p>
                             <div className="flex flex-wrap gap-2">
                                {report.warnings.map((w, i) => (
                                   <div key={i} className="px-3 py-1 bg-white/10 rounded-full text-[9px] font-black uppercase text-rose-400 border border-rose-400/30">{w}</div>
                                ))}
                             </div>
                          </DashboardCard>
                       )}
                    </>
                 )}

                 {/* --- DIET TAB --- */}
                 {activeTab === 'diet' && (
                    <div className="space-y-6">
                       <DashboardCard colorClass={VIVID_THEME.black} title="Anti-Inflammatory Plan" icon={Salad}>
                          <button onClick={generateDietPlan} className="w-full py-4 bg-teal-600 text-white rounded-2xl font-black uppercase text-xs mb-6 shadow-xl shadow-teal-900/20">Generate Daily Plan</button>

                          {dietPlan ? (
                             <div className="space-y-4">
                                {['breakfast', 'lunch', 'dinner', 'snack'].map(meal => (
                                   <div key={meal} className="p-4 bg-white/5 rounded-2xl border border-white/10 flex items-center gap-4">
                                      <div className="w-10 h-10 rounded-xl bg-teal-500/20 flex items-center justify-center text-teal-400">
                                         {meal === 'breakfast' && <Sun size={18}/>}
                                         {meal === 'lunch' && <Sun size={18}/>}
                                         {meal === 'dinner' && <Moon size={18}/>}
                                         {meal === 'snack' && <Apple size={18}/>}
                                      </div>
                                      <div>
                                         <h4 className="text-[10px] font-black uppercase text-teal-400">{meal}</h4>
                                         <p className="text-sm font-bold text-white">{dietPlan[meal]}</p>
                                      </div>
                                   </div>
                                ))}
                             </div>
                          ) : (
                             <div className="text-center py-12 opacity-40">
                                <Salad size={48} className="mx-auto mb-4"/>
                                <p className="text-xs font-black uppercase">Click above to generate plan</p>
                             </div>
                          )}
                       </DashboardCard>
                    </div>
                 )}

                 {/* --- CHAT TAB --- */}
                 {activeTab === 'chat' && (
                    <div className="h-[70vh] flex flex-col">
                       <div className="flex-1 overflow-y-auto space-y-4 mb-4">
                          {chatHistory.map((m, i) => (
                             <div key={i} className={`flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                <div className={`p-4 rounded-[2rem] max-w-[85%] font-bold text-sm ${m.role === 'user' ? 'bg-teal-600 text-white rounded-tr-none' : 'bg-white border-2 border-gray-100 text-gray-700 rounded-tl-none'}`}>
                                   {m.text}
                                </div>
                             </div>
                          ))}
                          <div ref={chatEndRef}/>
                       </div>

                       {/* CHAT INPUT + MIC */}
                       <div className="flex gap-2 bg-white p-2 rounded-[2rem] border-2 border-gray-100 shadow-lg">
                          <button
                            onClick={() => handleVoiceInput(setChatInput)}
                            className={`p-3 rounded-full transition-all ${isListening ? 'bg-red-500 text-white animate-pulse' : 'bg-gray-100 text-gray-500 hover:bg-teal-50 hover:text-teal-600'}`}
                          >
                            <Mic size={20}/>
                          </button>
                          <input value={chatInput} onChange={(e) => setChatInput(e.target.value)} placeholder="Ask Medical Assistant..." className="flex-1 p-3 bg-transparent font-bold outline-none"/>
                          <button onClick={() => { if(!chatInput) return; setChatHistory(prev => [...prev, {role:'user', text:chatInput}]); setChatInput(''); setTimeout(() => setChatHistory(prev => [...prev, {role:'model', text:"I'm your Medical Assistant. I see you took your morning meds. Keep it up!"}]), 1000); }} className="p-3 bg-teal-600 text-white rounded-full"><Send size={20}/></button>
                       </div>
                    </div>
                 )}

                 {/* --- VAULT TAB --- */}
                 {activeTab === 'vault' && (
                    <DashboardCard colorClass={VIVID_THEME.mint} title="Script Vault" icon={FolderOpen}>
                       <div className="grid grid-cols-2 gap-4">
                          {vault.map(v => (
                             <div key={v.id} className="bg-white p-3 rounded-2xl border-2 border-teal-50 shadow-sm">
                                <img src={v.image} className="w-full h-24 object-cover rounded-xl mb-2 bg-gray-100"/>
                                <h4 className="font-black text-xs truncate">{v.name}</h4>
                                <p className="text-[10px] font-bold text-gray-400">{v.date}</p>
                             </div>
                          ))}
                          <div onClick={() => fileInputRef.current.click()} className="bg-teal-100/50 p-3 rounded-2xl border-2 border-dashed border-teal-200 flex flex-col items-center justify-center min-h-[140px] cursor-pointer">
                             <Camera className="text-teal-400 mb-2"/>
                             <span className="text-xs font-black text-teal-600">SCAN NEW</span>
                          </div>
                       </div>
                    </DashboardCard>
                 )}

                 {/* --- ADMIN TAB --- */}
                 {activeTab === 'settings' && (
                    <div className="space-y-6">
                       <DashboardCard colorClass={VIVID_THEME.black} title="System" icon={Lock}>
                          <label className="text-xs font-black text-gray-500 uppercase ml-2">Gemini API Key</label>
                          <input type="password" value={apiKeys.gemini} onChange={(e) => setApiKeys({...apiKeys, gemini: e.target.value})} className="w-full p-4 bg-[#333] rounded-2xl text-white font-mono text-xs mt-2 border border-[#444] mb-4" placeholder="sk-..."/>

                          {/* PHARMACY CONFIGURATION */}
                          <div className="mb-6 border-t border-[#444] pt-4">
                             <h3 className="text-white font-black uppercase text-sm mb-3 flex items-center gap-2"><ShoppingCart size={16}/> Pharmacy Config</h3>
                             <div className="space-y-2">
                                <input value={pharmacy.name} onChange={(e) => setPharmacy({...pharmacy, name: e.target.value})} placeholder="Pharmacy Name" className="w-full p-3 bg-[#444] rounded-xl text-white text-xs border border-[#555]" />
                                <div className="flex items-center gap-2 bg-[#444] rounded-xl border border-[#555] px-3">
                                   <MessageCircle size={14} className="text-green-400"/>
                                   <input value={pharmacy.phone} onChange={(e) => setPharmacy({...pharmacy, phone: e.target.value})} placeholder="WhatsApp Number (e.g. 15550101)" className="w-full p-3 bg-transparent text-white text-xs outline-none" />
                                </div>
                                <div className="flex items-center gap-2 bg-[#444] rounded-xl border border-[#555] px-3">
                                   <Mail size={14} className="text-blue-400"/>
                                   <input value={pharmacy.email} onChange={(e) => setPharmacy({...pharmacy, email: e.target.value})} placeholder="Pharmacy Email (Optional)" className="w-full p-3 bg-transparent text-white text-xs outline-none" />
                                </div>
                             </div>
                          </div>

                          {/* EMERGENCY CONTACT CONFIG */}
                          <div className="mb-6 border-t border-[#444] pt-4">
                             <h3 className="text-white font-black uppercase text-sm mb-3 flex items-center gap-2"><AlertTriangle size={16} className="text-red-500"/> SOS Contact</h3>
                             <div className="flex items-center gap-2 bg-[#444] rounded-xl border border-[#555] px-3">
                                <Phone size={14} className="text-red-400"/>
                                <input value={emergencyContact} onChange={(e) => setEmergencyContact(e.target.value)} placeholder="Emergency Phone Number" className="w-full p-3 bg-transparent text-white text-xs outline-none" />
                             </div>
                          </div>

                          <div className="flex items-center justify-between p-4 bg-[#333] rounded-2xl mb-4">
                             <span className="text-white font-bold text-sm">Clinical Nutrition</span>
                             <button onClick={() => setShowDietModule(!showDietModule)} className="text-white">{showDietModule ? <ToggleRight className="text-green-400"/> : <ToggleLeft/>}</button>
                          </div>

                          <button onClick={() => {
                             const phone = emergencyContact ? emergencyContact.replace(/[^0-9]/g, '') : '';
                             if(!phone) return alert("Please set an Emergency Contact number above first.");
                             window.location.href = `sms:${phone}?body=SOS! I need help.`;
                          }} className="w-full py-4 bg-red-600 text-white font-black rounded-2xl uppercase mb-4 flex items-center justify-center gap-2"><AlertTriangle size={18}/> Emergency SOS</button>

                          <div className="grid grid-cols-2 gap-4">
                             <button onClick={handleExportData} className="py-4 bg-[#555] text-white font-black rounded-2xl uppercase text-xs flex items-center justify-center gap-2"><Save size={16}/> Backup Data</button>
                             <button onClick={() => { if(confirm("Reset App?")) localStorage.clear(); window.location.reload(); }} className="py-4 bg-[#444] text-red-400 font-black rounded-2xl uppercase text-xs">Factory Reset</button>
                          </div>
                       </DashboardCard>
                    </div>
                 )}
              </main>

              {/* INPUTS */}
              <input type="file" ref={fileInputRef} hidden accept="image/*" onChange={handlePillScan}/>

              {/* NAV */}
              <nav className="fixed bottom-0 left-0 right-0 bg-white border-t-4 border-teal-50 px-6 py-4 pb-8 flex justify-between items-center z-[800] shadow-[0_-10px_40px_rgba(0,0,0,0.05)]">
                 <button onClick={() => setActiveTab('home')} className={`flex flex-col items-center ${activeTab === 'home' ? 'text-teal-600' : 'text-gray-300'}`}><Sun size={24}/><span className="text-[9px] font-black uppercase mt-1">Home</span></button>

                 {/* DYNAMIC DIET TAB */}
                 {showDietModule && (
                    <button onClick={() => setActiveTab('diet')} className={`flex flex-col items-center ${activeTab === 'diet' ? 'text-teal-600' : 'text-gray-300'}`}><Leaf size={24}/><span className="text-[9px] font-black uppercase mt-1">Diet</span></button>
                 )}

                 <div className="relative -top-6"><button onClick={() => setActiveTab('chat')} className="w-16 h-16 bg-[#26A69A] rounded-full border-4 border-[#E0F2F1] shadow-xl flex items-center justify-center text-white active:scale-95 transition-all"><MessageCircle size={32}/></button></div>
                 <button onClick={() => setActiveTab('vault')} className={`flex flex-col items-center ${activeTab === 'vault' ? 'text-teal-600' : 'text-gray-300'}`}><FolderOpen size={24}/><span className="text-[9px] font-black uppercase mt-1">Vault</span></button>
                 <button onClick={() => setActiveTab('settings')} className={`flex flex-col items-center ${activeTab === 'settings' ? 'text-teal-600' : 'text-gray-300'}`}><Settings size={24}/><span className="text-[9px] font-black uppercase mt-1">Admin</span></button>
              </nav>

              {/* STYLES */}
              <style>{`
                @keyframes shout-lean { 0%, 100% { transform: scale(1.0) rotate(0deg); } 50% { transform: scale(1.1) rotate(5deg); } }
                @keyframes bounce-gentle { 0%, 100% { transform: translateY(0) translateX(-50%); } 50% { transform: translateY(-10px) translateX(-50%); } }
                @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }
                @keyframes pulse-soft { 0%, 100% { transform: scale(1); opacity: 0.6; } 50% { transform: scale(1.05); opacity: 0.8; } }
              `}</style>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
